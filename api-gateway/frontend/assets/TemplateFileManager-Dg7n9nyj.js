import{r as f,u as w,j as e,m as n,F as j}from"./index-0B-QrMym.js";import{u as v}from"./useQuery-gFyUPQ7C.js";import{u as g}from"./useMutation-DdaFRHUm.js";import{a as p}from"./api-BgONvxhD.js";import{P as N}from"./plus-CaDpXQUP.js";import{D as y}from"./download-BfIeGHGd.js";import{T as C}from"./trash-2-CzVBZmWj.js";const D=({isOpen:r,onClose:d,fileType:m,onSuccess:c})=>{const[t,i]=f.useState({name:"",description:"",file:null}),[u,o]=f.useState(!1),x=async l=>{if(l.preventDefault(),!(!t.file||!t.name.trim())){o(!0);try{const s=new FormData;s.append("name",t.name),s.append("file_type",m),s.append("file",t.file),t.description&&s.append("description",t.description),await p.post("/template-files/",s,{headers:{"Content-Type":"multipart/form-data"}}),c(),d(),i({name:"",description:"",file:null})}catch(s){console.error("Upload failed:",s),alert("Failed to upload template file")}finally{o(!1)}}};return r?e.jsx("div",{className:"modal-overlay",children:e.jsx(n.div,{className:"modal-content max-w-md",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-neutral-900 mb-4",children:["Upload Template ",m==="resume"?"Resume":"Cover Letter"]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Template Name"}),e.jsx("input",{type:"text",value:t.name,onChange:l=>i(s=>({...s,name:l.target.value})),className:"input-field",placeholder:"e.g., Senior Software Engineer Resume",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:t.description,onChange:l=>i(s=>({...s,description:l.target.value})),className:"input-field",rows:2,placeholder:"Brief description of when to use this template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"File"}),e.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:l=>i(s=>{var a;return{...s,file:((a=l.target.files)==null?void 0:a[0])||null}}),className:"input-field",required:!0}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Supported formats: PDF, DOC, DOCX"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(n.button,{type:"button",onClick:d,className:"btn-secondary flex-1",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Cancel"}),e.jsx(n.button,{type:"submit",disabled:u||!t.file||!t.name.trim(),className:"btn-primary flex-1",whileHover:{scale:1.02},whileTap:{scale:.98},children:u?"Uploading...":"Upload"})]})]})]})})}):null},M=({fileType:r,title:d})=>{const[m,c]=f.useState(!1),t=w(),{data:i,isLoading:u}=v({queryKey:["template-files",r],queryFn:()=>p.get(`/template-files/?file_type=${r}`).then(a=>a.data)}),o=g({mutationFn:a=>p.delete(`/template-files/${a}`),onSuccess:()=>{t.invalidateQueries({queryKey:["template-files",r]})}}),x=a=>{window.open(`${p.defaults.baseURL}/template-files/${a}/download`,"_blank")},l=async(a,h)=>{if(confirm(`Are you sure you want to delete "${h}"?`))try{await o.mutateAsync(a)}catch(b){console.error("Delete failed:",b),alert("Failed to delete template")}},s=()=>{t.invalidateQueries({queryKey:["template-files",r]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-medium text-neutral-900",children:["Template ",d]}),e.jsxs(n.button,{onClick:()=>c(!0),className:"btn-secondary text-sm",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Add Template"]})]}),u?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Array.from({length:2}).map((a,h)=>e.jsxs("div",{className:"card p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-neutral-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-neutral-100 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-8 bg-neutral-200 rounded w-full"})]},h))}):i&&i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(a=>e.jsxs(n.div,{className:"card p-4 hover:shadow-md transition-shadow",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-neutral-100 flex-shrink-0",children:e.jsx(j,{className:"h-4 w-4 text-neutral-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"font-medium text-neutral-900 truncate",title:a.name,children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-neutral-600 mt-1 line-clamp-2",children:a.description}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:a.filename})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n.button,{onClick:()=>x(a.id),className:"btn-secondary text-xs flex-1",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"Download"]}),e.jsx(n.button,{onClick:()=>l(a.id,a.name),className:"btn-secondary text-xs text-red-600 hover:bg-red-50",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:o.isPending,children:e.jsx(C,{className:"h-3 w-3"})})]})]},a.id))}):e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"text-left border-2 border-dashed border-neutral-200 rounded-lg p-8 max-w-sm",children:[e.jsx("div",{className:"p-3 rounded-full bg-neutral-100 w-fit mb-3",children:e.jsx(j,{className:"h-6 w-6 text-neutral-400"})}),e.jsxs("p",{className:"text-neutral-600 text-sm mb-4",children:["No template ",d.toLowerCase()," yet"]}),e.jsx("div",{className:"flex justify-start",children:e.jsxs(n.button,{onClick:()=>c(!0),className:"btn-primary text-sm",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Add First Template"]})})]})}),e.jsx(D,{isOpen:m,onClose:()=>c(!1),fileType:r,onSuccess:s})]})};export{M as T};
